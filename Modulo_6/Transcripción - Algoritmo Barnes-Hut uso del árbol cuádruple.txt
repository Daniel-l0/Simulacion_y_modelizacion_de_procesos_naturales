[MÚSICA] Hola, bienvenidos nuevamente a nuestra clase de simulación y modelado de procesos naturales. En nuestro modelo anterior, introdujimos un algoritmo llamado algoritmo de Barnes-Hut. Este algoritmo se puede utilizar para acelerar los cálculos de un sistema de n cuerpos, un sistema en el que calculamos la interacción entre una gran cantidad de cuerpos celulares bajo la influencia de la gravedad. Este algoritmo se denomina algoritmo de árbol y subdivide el espacio en árboles cuádruples en 2D y ocárboles en 3D para representar grupos, porciones de espacio en grupos que podrían usarse como un solo cuerpo, para simplificar la interacción con un cuerpo, entre un cuerpo y esta parte del espacio. En el módulo anterior hemos visto cómo crear un árbol cuaternario de este tipo de forma intuitiva, o un octárbol en 3D. Y ahora veremos cómo usar el árbol previamente construido para calcular la fuerza, la fuerza neta de todos los demás cuerpos celulares sobre un cuerpo, en nuestro caso el cuerpo número uno. Para ello tenemos que recurrir a nuestro árbol y considerar todas sus hojas de forma recursiva. En el primer nivel, consideramos los primeros cuadrantes, cuadrantes directos que dividen los cuatro espacios en cuatro partes. Si están lo suficientemente lejos del cuerpo número uno, podemos usar su masa y su centro de masa para simplificar las interacciones entre el cuerpo uno y todos los cuerpos que están dentro de este cuadrante. Y representados por un solo cuerpo situado en el centro de masa. Si no están lo suficientemente lejos, tendremos que recurrir a los subcuadrantes, las porciones de espacio más pequeñas, contenidas dentro de este cuadrante. Vamos a ver cómo funciona esto. Nos interesa la fuerza neta que actúa sobre el cuerpo uno, que en esta imagen es roja. Para ello, recurrimos a nuestro árbol y empezamos por el primer nivel de recursión. El nivel del cuadrante rojo del que disponemos totalmente. El primer cuadrante es el cuadrante sureste. Contiene un solo cuerpo, el cuerpo número uno. Pero el cuerpo número uno no ejerce ninguna fuerza sobre sí mismo. Así que rechazaremos este y seguiremos con el segundo cuadrante, el cuadrante noreste. Este cuadrante contiene un total de cinco cuerpos. Hemos calculado previamente el centro de masa de este cuadrante y ahora podemos calcular la distancia entre el cuerpo uno y el centro de masa de este cuadrante. Ahora tenemos que decidir si es razonable representar estos cinco cuerpos por el centro de masa o no. Si estos cinco cuerpos están lo suficientemente lejos, entonces podemos aceptar esta abstracción. Si están demasiado cerca, no podemos representarlos por el centro de masa. ¿Qué significa demasiado lejos o demasiado cerca? También depende del tamaño del grupo que estemos considerando. Porque los cuerpos muy lejanos no se pueden representar con grupos grandes, pero los cuerpos cercanos solo se pueden representar con grupos muy pequeños. Por lo tanto, debemos tener en cuenta también las longitudes de los lados del cuarto que representa el grupo de estos cinco cuerpos estelares. Lo que realmente importa no es el valor real de d o el valor real de c de s, sino la relación entre ambos, es decir, la relación entre s y d. A esto lo llamamos criterio theta. Aceptaremos un cuadrante dado y representaremos sus cuerpos por su centro de masa. Si la relación entre s y d, s sobre d, es inferior a un valor umbral determinado, que vamos a denominar theta, se puede elegir de acuerdo con los requisitos de su simulación. Si theta es cero, entonces, o si theta está cerca de cero, lo que significa es que no aceptaremos ninguna representación de grupos de cuerpos por el centro de masa. Y consideremos todas las interacciones por pares entre todos los cuerpos celulares. Tu algoritmo estará en forma cuadrada. Si, por otro lado, theta es bastante grande, entonces esperarás bastante aproximación. No sería muy eficiente desde el punto de vista numérico, pero tendremos en cuenta los posibles errores numéricos importantes. Procedente de la representación de muchas estrellas, mediante un centro de masa del grupo. Un valor bastante frecuente de theta es theta igual a la mitad. Y este es el valor que se usará como ejemplo en esta presentación. Pero, por supuesto, casi todos los valores se utilizan también en la simulación numérica. Aquí theta T multiplicado por la mitad, entonces el criterio theta equivale a decir que s sobre d es menor que la mitad. O, dicho de otro modo, d es mayor que 2s. Lo que significa que la distancia entre nuestro cuerpo y el centro de masa del cuadrante es mayor que el doble de la longitud de los lados de este cuadrante. ¿Se verifica el criterio theta en nuestro caso? Ahora vemos visualmente la longitud de d y la longitud de s. Y así es, podemos ver inmediatamente que la d no es mayor que el doble de s. Obviamente, el criterio theta no se verifica aquí. La d y la s tienen casi la misma longitud. Por lo tanto, debemos volver a los cuadrantes rojos y considerar cuatro subcadenas verdes, sus subcuadrantes. Desde la derecha, en el primer nivel de recursión, podemos ver el cuadrante derecho, y ahora estamos recurriendo al segundo nivel, donde seguimos formando cuadrantes verdes, que se encuentran dentro del cuadrante retiniano. Empezamos con el primer cuadrante verde, que es el cuadrante sureste. Tengo que volver a decidir si los dos cuerpos contenidos en este cuadrante pueden aproximarse al centro de Marte, así que volvemos a empezar todo el procedimiento. Calculamos la distancia d entre el cuerpo uno y el centro de Marte de este cuadrante y la comparamos con la longitud de los lados de este cuadrante. Una vez más, basta con observar visualmente este ejemplo para ver inmediatamente que la distancia d no es mayor que el doble de la longitud del lado s. Por lo tanto, esta columna debe rechazarse nuevamente. Debemos volver a introducir recursividad en esta columna e ir al tercer nivel de recursión. Para asegurarnos de que puede apreciar este hecho, hemos trazado el doble de la longitud de los lados de x. Y pueden ver, solo visualmente, que es mayor que d. Ahora maldecimos en el tercer nivel y consideramos los cuadrantes negros que son nodos de los árboles, lo que significa que solo contienen cuerpos individuales. En este nivel, por supuesto, aceptamos los cuerpos por defecto, porque volvemos al caso más simple de interacciones puras y sabias entre el cuerpo uno y los cuerpos dos y tres. En este caso, los enlaces tienen un algoritmo, que no nos ha servido de nada computacionalmente porque estas dos estrellas estaban demasiado cerca. Pero sigamos y recorramos el árbol de cuartos que estamos construyendo. Ahora mismo estamos en el cuadrante rojo noreste y estamos atravesando el cuadrante verde contenido dentro de este cuadrante rojo. Terminamos con el primer cuadrante verde, que era el cuadrante sureste, y continuamos con el cuadrante noreste. Que contiene de nuevo dos cuerpos, el cuerpo cuatro y el cuerpo cinco. Hacemos el mismo procedimiento una y otra vez calculando la distancia. Entre el cuerpo uno y el centro de masa de este cuadrante. Y compara esta distancia d con el doble de la longitud de los lados de este cuadrante, 2s. Si pones 2s y d uno al lado del otro, verás que esta vez se verifica el criterio feta. D es mayor que 2 en este caso. No podemos usar la abstracción de representar los cuerpos cuatro y cinco por el centro de masa. El centro de masa se calculó previamente y se almacena dentro de este nodo del cuadrante. Por lo tanto, podemos calcular de inmediato la fuerza neta de estos dos cuerpos sobre el cuerpo uno y sumarla a la fuerza total que actúa sobre el cuerpo uno. Tras estos primeros ejemplos de cómo usar el árbol cuádruple, demos un paso atrás y formalicemos el algoritmo recursivo del uso del árbol cuádruple. En general, estamos intentando calcular la fuerza ejercida sobre un cuerpo B. Utilizaremos un procedimiento recursivo, empezando por la nota raíz de nuestro árbol cuadrilátero. El procedimiento recursivo funciona de la siguiente manera. Si el nodo considerado actualmente es un nodo exterior, es decir, un nodo que no tiene hijos, y si este nodo no es realmente igual a nuestro cuerpo b, entonces basta con considerar una interacción por pares entre b y el cuerpo definido en este nodo. Y añada esta cantidad a la fuerza neta que actúa sobre el cuerpo b. Si se trata de un nodo interior, debemos decidir si podemos usar todos los cuerpos que están contenidos en el cuadrante de este nodo y abstraerlos como un solo cuerpo en el centro de masa. Tenemos que aplicar el criterio theta. Calculando la relación s/d, entre la longitud lateral del cuadrante s y la distancia d entre el cuerpo b y el centro de mayor masa de este cuadrante. Si s/d es menor que theta, tratamos este nodo interno como un solo cuerpo y calculamos la fuerza que ejerce sobre el cuerpo b. La sumamos a la fuerza neta total que actúa sobre el cuerpo b. Si, por otro lado, no se verifica el criterio theta, debemos continuar con el procedimiento recursivo. Y recurva hacia los hijos del nodo externo, del nodo cuantitativo. Ahora que hemos hablado del algoritmo en términos generales. Podemos seguir el procedimiento completo de calcular la fuerza neta de nuestros nueve cuerpos compañeros sobre el cuerpo número uno. Hasta ahora hemos tratado la interacción del cuerpo redondo con el cuerpo dos, tres, cuatro y cinco, y continuamos con el cuerpo seis. Que está en el cuadrante suroeste, cuadrante verde del cuadrante directo noreste. Ahí está solo, por lo que, por defecto, lo trataremos como una interacción por pares. Continuando con el último cuadrante rojo, que es el cuadrante noroeste. Empezamos rechazando la hipótesis de que estos cuadrantes rojos puedan considerarse como un solo cuerpo porque ya es bastante obvio que estarán demasiado cerca del cuerpo número uno. Y en su lugar vuelve a entrar en el cuadrante verde. El primero, el nororiental, tiene tres cuerpos, que están representados por el centro de masa y que sí verifican el criterio del centro. No podemos tratarlos como un solo cuerpo. Y por último, el cuerpo número diez vuelve a estar solo dentro de este cuadrante verde. Lo tratamos como una interacción de un solo par. Con esto, hemos resuelto el problema, resuelto el árbol y calculado la fuerza neta total de todos los cuerpos. Actuando sobre el cuerpo paso a paso del tiempo recursivo e iterativo de nuestro algoritmo numérico. En este caso particular, recorrer este complicado árbol no ha sido, desde el punto de vista numérico, más eficiente que tratar todas las interacciones n cuadradas entre estos cuerpos. Pero solo había diez cuerpos. Si hubiera habido, digamos, mil millones de cuerpos, atravesar este árbol habría sido mucho más barato que considerar n al cuadrado, que son mil millones de interacciones cuadradas por pares. La complejidad real del algoritmo, si se tiene en cuenta el árbol, depende de algunos parámetros. Y, en particular, depende del valor de theta. Pero en muchos casos, se puede demostrar teóricamente que la complejidad total de este algoritmo es igual a n n veces el logaritmo de n, lo que se acerca mucho a una complejidad lineal n. También tenemos un algoritmo que es numéricamente muy eficiente, como el algoritmo basado en el valor y una estructura de datos basada en cuadrículas que aplicamos en dinámica molecular para el potencial de Lennard-Jones. Si, por ejemplo, tratara 5000 cuerpos en lugar de 10, simplemente aplicaría exactamente el mismo procedimiento. Vean aquí, por ejemplo, los 5.000 cuerpos que consideramos en el caso de dos galaxias en colisión. Aunque para 10 cuerpos, el algoritmo de Barnes-Hut puede resultar exagerado, para 5000 cuerpos sin duda vale la pena y mejora el tiempo de cálculo. Esta es una representación del árbol de 4 cuadrúpedos, que creaste para representar las 5000 estrellas, los 5000 cuerpos, en este ejemplo. E imagina que tratas de calcular la fuerza que actúa sobre la estrella que está en el centro del sistema, representada aquí por un punto rojo. Usando un valor theta de 0.7, verás que cerca del cuerpo necesitarás usar cuadrantes que son bastante pequeños, pero lejos de este cuerpo, podrás usar cuerpos muy grandes. En concreto, la galaxia pequeña que gravita alrededor de la galaxia grande puede representarse mediante aproximadamente cuatro cuadrantes. La interacción de esta galaxia lejana con nuestro punto rojo se puede calcular de forma extremadamente eficiente, teniendo en cuenta solo un poco más de cuatro términos. Con esto termina nuestro módulo sobre el algoritmo de Barnes-Hut sobre el uso de un árbol cuádruple. También termina hoy esta semana y termina nuestra clase sobre métodos de partículas y, en general, sobre aproximaciones poligénicas de sistemas con muchas partículas o muchos cuerpos. Gracias por su asistencia. [MÚSICA]