[MÚSICA] Hola y bienvenidos de nuevo a nuestra clase, Simulación y Modelación de Procesos Naturales. El siguiente módulo trata sobre el problema de los n-cuerpos en el que hablamos de cómo evaluar las fuerzas gravitatorias. Recuerden el ejemplo que les mostré de dos galaxias que colisionan. Observe cómo estas dos galaxias giran alrededor de un centro de masa común. No modelizamos esta rotación alrededor del centro de masa común de forma explícita. Lo único que modelizamos realmente aquí es la interacción individual entre pares de estrellas. La rotación alrededor del centro de masa común es un comportamiento emergente de las interacciones por pares de todos los cuerpos de este sistema. Esto significa que se trata de un sistema con fuerzas de largo alcance. Todas las estrellas del sistema se ven afectadas por la posición de todas las demás estrellas. Recuerde que en el módulo anterior hablamos del potencial de Lennard-Jones, y vimos que podíamos reducir y simplificar el problema, introduciendo una longitud de corte, lo que significa que estábamos considerando limitar la interacción entre las partículas y algunas partículas cercanas que estaban contenidas dentro de una longitud de corte. No podemos hacer esto en el caso de un problema de n cuerpos porque todas las demás estrellas son importantes, no hay ninguna que podamos eliminar. Sin embargo, existen otras técnicas para facilitar los cálculos y vamos a hablar de ellas ahora. Una aproximación muy utilizada son los llamados métodos de árbol. La idea de este método es que si un grupo de cuerpos está lo suficientemente alejado que modelemos este grupo como un solo cuerpo, que se sitúa en el centro de masa del grupo, y que tiene la masa de todos los cuerpos dentro de este grupo. Imagínese, por ejemplo, que fuera a simular la interacción entre millones de galaxias. En ese caso, seguro que no modelaría cada una de las estrellas del interior de estas galaxias. Se limitaría a modelar las propias galaxias como partículas individuales, como cuerpos individuales con un centro de masa determinado, una masa determinada que es la masa agregada de todas las estrellas del sistema. En los métodos arbóreos, la idea es que generalicemos este enfoque. Reagrupando porciones del espacio y representando estos grupos por su centro de masa para acelerar los cálculos. Consideremos por ejemplo el caso de diez cuerpos que interactúan. Por supuesto, si sólo tiene diez cuerpos, tener en cuenta todas las interacciones por pares, que serán del orden de diez al cuadrado, es decir 100, no sería un problema. Sólo es un problema cuando tiene una gran cantidad de cuerpos. Pero utilizamos el caso de diez cuerpos para ilustrar el concepto y luego mostrar cómo se generalizan a problemas mayores. En este caso queremos calcular la fuerza gravitatoria resultante que actúa sobre el cuerpo 1. Las fuerzas gravitatorias no son locales, por lo que nunca perdemos la aproximación de fuerzas. Necesitamos tener en cuenta la interacción entre el cuerpo uno, el cuerpo rojo, y sus nueve compañeros. Necesitamos calcular nueve fuerzas y sumarlas. Pero la idea es que se puede acelerar el cálculo. Tomaría un grupo de cuerpos, como en este caso los cuerpos siete, ocho y nueve y los trataría como un solo cuerpo. Situados en el centro de masa, y tratar la interacción entre estos tres cuerpos y el cuerpo uno como una única interacción. Es una aproximación razonable si este grupo está lejos. Si estuviera muy cerca del cuerpo uno, tendríamos que tener en cuenta la interacción de cada uno de los cuerpos. Porque cada uno de los cuerpos estaría relativamente situado a distancias y ángulos muy diferentes con respecto al cuerpo uno. Pero si están lejos, la diferencia relativa de la distancia de los distintos cuerpos, siete, ocho y nueve, a lo largo del ángulo del vector que apunta desde el cuerpo uno a estos otros cuerpos diferiría muy poco. Es razonable aproximarlos por su posición en el centro de masa. Pero la cuestión es, ¿cómo definimos estos grupos? Una aproximación sería decir, hagamos lo mismo que hicimos con el potencial de Lennard-Jones y superpongamos una cuadrícula, una cuadrícula espacial regular, al espacio del objeto. Usaríamos entonces esta subdivisión regular y trataríamos como grupos o cuerpos, los que están situados dentro de una celda de esta rejilla regular. En este caso, resulta que esto funciona para el grupo de cuerpos, siete, ocho y nueve del que hablábamos antes. Están todos en la misma celda y los tratamos como un único grupo. Pero aunque a veces esta estrategia funciona, a veces falla, porque los cuerpos dos y tres también están situados dentro de una celda, pero están muy cerca del cuerpo número uno. En este caso, la aproximación no es buena. Necesitaríamos tratar la interacción entre el cuerpo uno y los cuerpos dos y tres individualmente, como interacciones por pares. Aproximarlos por el centro de masa no es una buena aproximación. De hecho, en este caso necesitamos tener grupos de diferentes tamaños. Grupos pequeños para los que están cerca, y grupos grandes para los que están lejos, para los cuerpos distantes. Una solución son los algoritmos de árbol en los que recursivamente subdividimos el espacio en primer lugar, grupos grandes y después grupos cada vez más pequeños. Cada cuerpo del sistema está encerrado tanto en grupos pequeños como en grupos grandes, lo que significa que cuando tratamos de considerar la interacción con estos cuerpos, podemos seleccionar un grupo de un tamaño apropiado para el problema que estamos considerando, lo que significa que el tamaño del grupo es adecuado con la distancia entre el cuerpo sobre el que actúa la fuerza y el grupo para el que estamos considerando la interacción. Existen diferentes algoritmos basados en árboles para tratar este problema. Y voy a introducir aquí uno muy clásico que se llama algoritmo de Barnes-Hut. En el algoritmo de Barnes-Hut el espacio se subdivide en cuadrantes en un caso 2D, y en octantes en el espacio 3D. Lo que significa que en 2D, tomamos recursivamente un cuadrado y lo subdividimos en cuatro octantes y volvemos a tomar estos octantes y los subdividimos en cuatro octantes más pequeños y así sucesivamente. En el volumen 3D, un bloque se subdivide en octantes, que se subdividen una y otra vez. En la parte derecha de esta imagen puede ver un gráfico que representa la estructura recursiva del árbol de octantes de la izquierda. Ahora voy a mostrarle exactamente lo que significa este gráfico y le mostraré cómo creamos estos gráficos a partir de la posición de los cuerpos en el sistema en un conjunto temporal determinado. Pero, primero, vamos a introducir algo de nomenclatura. Si tomamos el espacio completo, el cuadrado completo, y lo subdividimos en cuatro cuadrantes, tendremos un cuadrante que está situado a la derecha izquierda del sistema. Lo llamamos cuadrante sureste. Y encima de él el cuadrante noreste en la parte superior derecha. En la parte inferior izquierda tenemos el cuadrante suroeste, y encima de él, el cuadrante noroeste. En la parte derecha de este esquema, vamos a construir un gráfico que represente la estructura recursiva de estas coordenadas. Empezamos el gráfico por un único punto que representa el espacio completo, un punto azul. Ahora que subdividimos el espacio en cuatro cuadrantes, este punto tiene hasta cuatro hijos, que representan los cuadrantes. Tomaremos estos hijos siempre en el mismo orden. Empezamos por el cuadrante sureste, que es el hijo situado más a la izquierda del nodo raíz del árbol, seguido del cuadrante noreste, que será el segundo hijo de la raíz del árbol. A continuación, el cuadrante suroeste y, por último, el cuadrante noroeste. Tenemos ahora un árbol, que tiene un nodo raíz que es azul, y cuatro nodos hijos que representan los cuatro cuadrantes del espacio. Tomemos ahora nuestros cuerpos estelares y los insertamos en esta estructura de datos. Empecemos con el primero que es el cuerpo número uno. Puede ver que el cuerpo número uno está situado en el cuadrante sureste. Esto significa que lo tomamos y lo añadimos a la estructura de árbol en la rama más a la izquierda que representa el cuadrante sureste. El cuerpo estelar se encuentra ahora en el llamado nodo exterior del árbol por ser un nodo final de la estructura del gráfico, no tiene, por ahora, ningún nodo hijo. Pero esto podría cambiar en el futuro, como veremos. Ahora introduciremos el segundo cuerpo y lo colocaremos en el árbol. El segundo cuerpo se coloca en el cuadrante noreste, lo que significa que lo colocamos en la segunda rama, o en la hoja de la segunda rama en la estructura del grafo. Es, de nuevo, un nodo exterior, y ese nodo del árbol. El tercer cuerpo resulta que también se encuentra en el segundo cuadrante, lo que significa que estará en conflicto con la posición del segundo cuerpo dentro del árbol. Por definición, este árbol está construido de tal manera que todos los nodos del árbol pueden contener como máximo un único cuerpo. Por lo tanto, necesitamos resolver este conflicto, lo que hacemos tomando este cuadrante noreste y subdividiéndolo en cuatro cuadrantes más pequeños. En este segundo nivel de recursión dibujaremos los cuadrantes en color verde, mientras que en el primer nivel de recursión utilizamos un color rojo para representar los cuadrantes. En el segundo nivel de recursividad, el cuadrante noreste, el cuadrante rojo, noreste, se subdivide en cuatro cuadrantes verdes, que de nuevo recorreremos en el mismo orden. Los cuadrantes verdes son recorridos primero por los cuadrantes sureste, luego noreste, y así sucesivamente. Empecemos por el sureste donde los cuerpos que han chocado, que han estado en conflicto, los cuerpos dos y tres, vuelven a encontrarse en el mismo cuadrante en el segundo nivel de recursión. Así que incluso en el segundo nivel de recursividad, tenemos un conflicto con la posición de estos dos cuerpos porque intentan posicionarse en el mismo nodo del árbol. Necesitamos, por tanto, tomar este árbol y subdividirlo una vez más. Tomamos el cuadrante verde sureste y lo subdividimos una vez más en cuatro cuadrantes negros, lo que se encuentra en el tercer nivel de recursividad. En el tercer nivel de recursión, bien, los dos cuerpos, el dos y el tres, ya no chocan porque el cuerpo número 2 está colocado en el cuadrante sureste, que es la primera rama de este árbol, y el tercer cuerpo está colocado en el cuadrante noroeste. En este caso, hemos terminado con la recursión, y hemos podido colocar los cuerpos 2 y 3 en nodos exteriores del grafo, en n nodos, en los que están solos como deberían estar por definición dentro de este árbol. Al insertar estos cuerpos en el árbol, cada nodo, sin importar en qué nivel de recursión se encuentre y sin importar si es un nodo interior o un nodo exterior, tiene una masa dada y un centro de masa dado. Recuerde que cada nodo representa un cuadrante dado en el sistema de un tamaño dado. Si el nodo está en el primer nivel de recursión, representará uno de los cuadrantes rojos grandes. Si está en el segundo nivel de recursión, representará uno de los cuadrantes verdes más pequeños. Y en el tercer nivel de recursión, uno de los cuadrantes negros muy pequeños. Cada uno de estos cuadrantes, potencialmente, contiene algunos cuerpos, que pueden ser varios. En el último nivel de recursividad, en cargas extremas, por definición sólo tienen un cuerpo. Pero en un nivel de recursividad superior, por ejemplo el cuadrante rojo, puede haber varios cuerpos en su interior. Por lo tanto, necesitamos, como siempre que introducimos un nuevo cuerpo, reactualizar el centro de masa asignado a cada uno de estos nodos. Cuando tenemos dos cuerpos, por ejemplo, dentro de un cuadrante, pues bien, la masa total del cuadrante en el que se encuentran estos dos cuerpos es simplemente la suma de los dos cuerpos, por supuesto. Y el centro de masa, es simplemente la suma ponderada de la posición de estos dos cuerpos, lo que significa que la posición del centro de masa es la posición del primer cuerpo multiplicada por su masa más la posición del segundo cuerpo multiplicada por su masa de nuevo, dividido por la masa total. A estas alturas, a través de este ejemplo, creo que ha comprendido más o menos el algoritmo que aplicamos para insertar cuerpos recursivamente en el árbol y para actualizar los valores de la masa total y del centro de masa de cada nodo dentro de este árbol. Pero formalicemos este algoritmo. En este algoritmo, tomamos un cuerpo, b, y empezamos a insertarlo en un árbol recursivamente empezando por el nodo raíz, n. Dentro de esta recursividad, si un nodo está vacío, lo que significa que aún no contiene un cuerpo, entonces cuando terminamos simplemente tomamos el cuerpo, b, y lo colocamos allí. Y tenemos un nuevo nodo n con este cuerpo, b. Pero si por el contrario el nodo es un nodo interno, lo que significa que contiene hijos, entonces mientras que este nodo representará una porción de espacio en la que ahora mismo hemos introducido un nuevo cuerpo, lo que significa que este nodo necesita actualizar su masa total y su centro de masa para tener en cuenta la masa y posición del nuevo cuerpo b. Entonces, insertamos recursivamente un cuerpo b en el cuadrante apropiado, que es uno de los hijos de este nodo, repitiendo de nuevo el mismo algoritmo. Por último, si el nodo n en el que intentamos colocar el cuerpo ya es un nodo exterior, entonces esto significa que ya contiene un cuerpo anterior que fue insertado previamente y que colisiona con el cuerpo que estamos intentando insertar. En este caso, tenemos que dividir aún más el nodo base en cuatro cuadrantes y colocar los dos cuerpos que estaban en conflicto en su cuadrante correspondiente y volver a aplicar este procedimiento recursivamente si vuelven a colisionar. Y eso es lo que hacemos con esto. Cada vez que tratamos un nuevo nodo, actualizamos el centro de masa de este nuevo nodo para tener en cuenta la masa de los dos cuerpos en conflicto. También, por supuesto, actualizamos el centro de masa, para tener en cuenta su posición. Ahora que tenemos este coste de los términos generales del algoritmo, terminemos de insertar todas las diez partículas, o todos los diez cuerpos estelares que tenemos en este sistema. Nos queda insertar los cuerpos dos y tres, que estaban colisionando y que tenemos que llevar al tercer nivel de recursión para encontrar n nodos en los que estén separados el uno del otro. El cuerpo número cuatro se coloca en el cuadrante noreste en el primer nivel de recursividad, lo que significa el cuadrante noreste derecho. El cuadrante noreste derecho está todo listo y entonces t nodos allí están todos los cuerpos listos. Entonces vamos al siguiente nivel, al nivel verde, el segundo nivel de recursividad y vemos que este nivel de recursividad, el nuevo cuerpo va al cuadrante noreste que está vacío. Por lo tanto creamos un nuevo nodo n y colocamos el cuerpo número cuatro en este cuadrante. Cuerpo número cinco, y vamos a tomar atajos ahora porque creo que ha entendido el concepto. El cuerpo número cinco está en el mismo cuadrante rojo y en el mismo cuadrante verde que el cuerpo número cuatro. Por lo tanto, tenemos que tomar este cuadrante y subdividirlo en dos cuadrantes negros en el tercer nivel de recursión y colocar los cuatro cuerpos colisionantes cuatro y cinco en su propio cuadrante de tercer nivel. Después de lo cual, insertamos todos los cuerpos restantes, seis, siete, ocho, nueve y diez. Vemos que en el primer nivel de recursión, el nivel rojo, un cuadrante permanece vacío. Es el cuadrante suroeste. Para este cuadrante, no asignamos nada. No existe en el árbol que acabamos de crear. Por otro lado, el cuadrante noroeste tiene un total de cuatro partículas. Una de las cuales, la partícula 10, se encuentra en su propio cuadrante verde, mientras que las partículas siete, ocho y nueve colisionaron o entraron en conflicto en el cuadrante verde noreste y se subdividieron en cuadrantes de bloque de tercer nivel. En el lado derecho, ahora puede ver el árbol completo. Todos los cuerpos son nodos finales en este árbol, y están representados por un nodo naranja. Los nodos azules son nodos interiores en los que no hemos colocado ningún cuerpo, pero que representan una porción de espacio que contienen los cuerpos que son hijos de estos nodos. Tienen su propio centro de masa y su propia masa total que hemos calculado y actualizado e insertado en sus cuerpos. Ahora que hemos creado esta estructura de árbol, estamos listos para aplicarla y utilizarla para calcular eficazmente las fuerzas que actúan desde todos los demás cuerpos sobre un cuerpo dado. Pero llevaremos esto al próximo módulo. Con esto termina nuestro módulo actual sobre la creación de un árbol, o un cuadárbol según el algoritmo Barnes-Hut. En el próximo módulo, describiremos cómo utilizamos este cuadárbol. Gracias. [MÚSICA]